<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Bridge Solver</title>
        <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <link rel="shortcut icon" href="/favicon.ico" />
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
        <link rel="manifest" href="/site.webmanifest" />
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://unpkg.com/lucide@latest"></script>
        <style>
            body {
                font-family: "Inter", sans-serif;
                background-color: #f8fafc;
            }

            /* タブのスタイル */
            .tab-active {
                border-bottom-color: #4f46e5;
                color: #4f46e5;
                background-color: #eef2ff;
            }
            .tab-inactive {
                border-bottom-color: transparent;
                color: #64748b;
            }
            .tab-inactive:hover {
                color: #334155;
                background-color: #f1f5f9;
            }

            /* PCカードボタン */
            .pc-rank-btn {
                font-size: 0.75rem;
                width: 1.6rem;
                height: 1.6rem;
                border-radius: 4px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.1s;
                border: 1px solid #e2e8f0;
                background: white;
                user-select: none;
            }
            .pc-rank-btn:hover {
                background-color: #f8fafc;
                border-color: #cbd5e1;
            }
            .pc-rank-btn.selected {
                background-color: #4f46e5;
                color: white;
                border-color: #4f46e5;
                font-weight: bold;
            }
            .pc-rank-btn.taken {
                background-color: #f1f5f9;
                color: #cbd5e1;
                cursor: not-allowed;
                border-color: transparent;
            }

            /* モバイル用フォーカス */
            .hand-card-mobile-active {
                border-color: #4f46e5 !important;
                box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1);
            }

            /* アニメーション */
            .fade-in {
                animation: fadeIn 0.3s ease-in-out;
            }
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(4px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            /* スート色 */
            .suit-s {
                color: #1e293b;
            }
            .suit-h {
                color: #ef4444;
            }
            .suit-d {
                color: #f97316;
            }
            .suit-c {
                color: #16a34a;
            }

            /* 基本テーブルスタイル */
            .result-table th {
                @apply px-4 py-2 text-xs font-bold text-slate-500 uppercase bg-slate-50 border-b border-slate-200;
            }
            .result-table td {
                @apply px-4 py-3 text-sm font-medium text-center border-b border-slate-100;
            }
            .result-table tr:last-child td {
                border-bottom: none;
            }

            /* 分布表示用テーブル (New) */
            .dist-table {
                width: 100%;
                border-collapse: collapse;
                font-size: 0.75rem;
                table-layout: fixed;
            }
            .dist-table th {
                background-color: #f8fafc;
                color: #64748b;
                padding: 4px;
                border: 1px solid #e2e8f0;
                font-weight: normal;
            }
            .dist-table td {
                text-align: center;
                padding: 4px;
                border: 1px solid #e2e8f0;
                color: #cbd5e1;
            }
            .dist-table td.has-val {
                color: #1e293b;
                font-weight: bold;
                background-color: #f0f9ff;
            }
            .dist-table td.high-val {
                background-color: #e0f2fe;
                color: #0369a1;
            }

            /* モバイルキーボード */
            .no-scrollbar::-webkit-scrollbar {
                display: none;
            }
            .no-scrollbar {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
        </style>
    </head>
    <body class="bg-slate-50 text-slate-800 min-h-screen flex flex-col">
        <header class="bg-white shadow-sm sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center gap-2">
                        <div class="bg-indigo-600 text-white p-1.5 rounded-lg">
                            <i data-lucide="play" class="w-5 h-5 fill-current"></i>
                        </div>
                        <span class="font-bold text-xl tracking-tight text-slate-900"
                            >Bridge Solver</span
                        >
                    </div>

                    <nav class="hidden md:flex space-x-8">
                        <button
                            id="nav-double"
                            class="tab-active px-3 py-2 text-sm font-medium border-b-2 transition-colors">
                            ダブルダミー分析
                        </button>
                        <button
                            id="nav-single"
                            class="tab-inactive px-3 py-2 text-sm font-medium border-b-2 transition-colors">
                            シングルダミー分析
                        </button>
                        <button
                            id="nav-lead"
                            class="tab-inactive px-3 py-2 text-sm font-medium border-b-2 transition-colors">
                            オープニングリード分析
                        </button>
                    </nav>

                    <div class="md:hidden">
                        <button id="mobile-menu-btn" class="p-2">
                            <i data-lucide="menu" class="text-slate-500"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div id="mobile-nav" class="hidden md:hidden bg-white border-b border-slate-200">
                <div class="flex flex-col p-2 space-y-1">
                    <button
                        id="mob-nav-double"
                        class="text-left px-3 py-2 text-sm font-medium rounded hover:bg-slate-50 text-indigo-600">
                        ダブルダミー分析
                    </button>
                    <button
                        id="mob-nav-single"
                        class="text-left px-3 py-2 text-sm font-medium rounded hover:bg-slate-50 text-slate-600">
                        シングルダミー分析
                    </button>
                    <button
                        id="mob-nav-lead"
                        class="text-left px-3 py-2 text-sm font-medium rounded hover:bg-slate-50 text-slate-600">
                        オープニングリード分析
                    </button>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 flex-grow w-full">
            <div id="view-double" class="flex-grow flex flex-col fade-in">
                <div class="flex justify-between items-center mb-6 px-1">
                    <h2 class="text-xl font-bold text-slate-800 flex items-center gap-2">
                        <span class="bg-indigo-100 text-indigo-700 p-1 rounded"
                            ><i data-lucide="grid" class="w-5 h-5"></i
                        ></span>
                        Double Dummy
                    </h2>
                    <div
                        class="text-xs font-mono text-slate-500 bg-white px-3 py-1.5 rounded border shadow-sm flex items-center gap-2">
                        <i data-lucide="layers" class="w-3 h-3"></i>
                        <span id="total-count" class="font-bold text-indigo-600">0</span> / 52
                        cards
                    </div>
                </div>

                <div
                    class="max-w-5xl mx-auto w-full grid grid-cols-1 md:grid-cols-3 gap-y-2 md:gap-y-0 md:gap-x-4 place-items-center items-center mb-4">
                    <div class="w-full md:col-start-2 md:row-start-1 z-10 md:-mb-6">
                        <div
                            id="hand-north"
                            class="hand-card bg-white p-3 rounded-xl shadow-sm border-2 border-transparent transition-all cursor-pointer md:cursor-default relative bg-white z-10">
                            <div
                                class="flex justify-between items-center mb-2 border-b border-slate-100 pb-1">
                                <span
                                    class="font-bold text-slate-700 text-sm uppercase tracking-wider"
                                    >North</span
                                >
                                <span
                                    class="text-[10px] text-white bg-slate-400 px-1.5 py-0.5 rounded-full count-badge"
                                    >0</span
                                >
                            </div>
                            <div id="container-north" class="space-y-1.5"></div>
                        </div>
                    </div>
                    <div class="w-full md:col-start-1 md:row-start-2">
                        <div
                            id="hand-west"
                            class="hand-card bg-white p-3 rounded-xl shadow-sm border-2 border-transparent transition-all cursor-pointer md:cursor-default">
                            <div
                                class="flex justify-between items-center mb-2 border-b border-slate-100 pb-1">
                                <span
                                    class="font-bold text-slate-700 text-sm uppercase tracking-wider"
                                    >West</span
                                >
                                <span
                                    class="text-[10px] text-white bg-slate-400 px-1.5 py-0.5 rounded-full count-badge"
                                    >0</span
                                >
                            </div>
                            <div id="container-west" class="space-y-1.5"></div>
                        </div>
                    </div>
                    <div class="w-full md:col-start-3 md:row-start-2">
                        <div
                            id="hand-east"
                            class="hand-card bg-white p-3 rounded-xl shadow-sm border-2 border-transparent transition-all cursor-pointer md:cursor-default">
                            <div
                                class="flex justify-between items-center mb-2 border-b border-slate-100 pb-1">
                                <span
                                    class="font-bold text-slate-700 text-sm uppercase tracking-wider"
                                    >East</span
                                >
                                <span
                                    class="text-[10px] text-white bg-slate-400 px-1.5 py-0.5 rounded-full count-badge"
                                    >0</span
                                >
                            </div>
                            <div id="container-east" class="space-y-1.5"></div>
                        </div>
                    </div>
                    <div class="w-full md:col-start-2 md:row-start-3 md:-mt-6">
                        <div
                            id="hand-south"
                            class="hand-card bg-white p-3 rounded-xl shadow-sm border-2 border-transparent transition-all cursor-pointer md:cursor-default relative bg-white z-10">
                            <div
                                class="flex justify-between items-center mb-2 border-b border-slate-100 pb-1">
                                <span
                                    class="font-bold text-slate-700 text-sm uppercase tracking-wider"
                                    >South</span
                                >
                                <span
                                    class="text-[10px] text-white bg-slate-400 px-1.5 py-0.5 rounded-full count-badge"
                                    >0</span
                                >
                            </div>
                            <div id="container-south" class="space-y-1.5"></div>
                        </div>
                    </div>
                </div>

                <div class="text-center mt-6 mb-10 md:mb-0">
                    <button
                        id="btn-run-double"
                        class="bg-indigo-600 hover:bg-indigo-700 text-white px-10 py-3 rounded-full font-bold shadow-lg shadow-indigo-200 transition-all active:scale-95 inline-flex items-center gap-2">
                        <i data-lucide="zap" class="w-5 h-5"></i> 分析実行
                    </button>
                </div>

                <div
                    id="result-double"
                    class="hidden mt-8 max-w-2xl mx-auto w-full bg-white rounded-xl shadow-md overflow-hidden border border-slate-200">
                    <div
                        class="bg-indigo-50 px-4 py-3 border-b border-indigo-100 flex justify-between items-center">
                        <h3 class="font-bold text-indigo-900 flex items-center gap-2">
                            <i data-lucide="table" class="w-4 h-4"></i> メイク数分析結果
                        </h3>
                        <span class="text-xs text-indigo-500 font-mono">DDS Engine</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full result-table">
                            <thead>
                                <tr>
                                    <th class="text-left w-20">Player</th>
                                    <th class="text-indigo-600">NT</th>
                                    <th class="text-slate-900">♠</th>
                                    <th class="text-red-500">♥</th>
                                    <th class="text-orange-500">♦</th>
                                    <th class="text-green-600">♣</th>
                                </tr>
                            </thead>
                            <tbody
                                id="result-body-double"
                                class="divide-y divide-slate-100"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="view-single" class="hidden fade-in">
                <div
                    class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                    <h2 class="text-2xl font-bold text-slate-800 flex items-center gap-2">
                        <i data-lucide="settings" class="text-emerald-500"></i> Single Dummy Solver
                    </h2>
                    <div
                        class="text-xs text-slate-500 bg-emerald-50 px-3 py-1 rounded border border-emerald-100">
                        <i data-lucide="info" class="inline w-3 h-3 mr-1"></i>
                        条件を指定してシミュレーションを行います
                    </div>
                </div>

                <div
                    class="max-w-7xl mx-auto w-full grid grid-cols-1 md:grid-cols-3 gap-y-2 md:gap-y-0 md:gap-x-4 place-items-stretch items-center mb-4">
                    <div
                        class="w-full md:col-start-2 md:row-start-1 bg-white p-5 rounded-lg border border-slate-200 shadow-sm relative z-10 md:-mb-6">
                        <div class="flex justify-between items-center mb-4 border-b pb-2">
                            <h4 class="font-bold text-slate-700 flex items-center gap-2">
                                <i data-lucide="user" class="w-4 h-4"></i> North
                            </h4>
                            <div class="flex bg-slate-100 rounded p-0.5">
                                <button
                                    class="sd-mode-switch px-2 py-0.5 text-[10px] font-bold rounded shadow-sm bg-white text-indigo-600"
                                    data-hand="north"
                                    data-mode="hand">
                                    Hand
                                </button>
                                <button
                                    class="sd-mode-switch px-2 py-0.5 text-[10px] font-bold rounded text-slate-500 hover:text-slate-700"
                                    data-hand="north"
                                    data-mode="feature">
                                    Feature
                                </button>
                            </div>
                        </div>

                        <div id="sd-mode-hand-north" class="sd-content-hand">
                            <div
                                class="text-[10px] text-white bg-slate-400 px-2 py-0.5 rounded-full inline-block mb-2 sd-count-badge">
                                0 / 13
                            </div>
                            <div id="sd-container-north" class="space-y-1"></div>
                        </div>

                        <div id="sd-mode-feature-north" class="sd-content-feature hidden">
                            <div class="mb-4">
                                <label class="text-xs font-semibold text-slate-500 uppercase"
                                    >HCP Range</label
                                >
                                <div class="flex items-center gap-2 mt-1">
                                    <input
                                        type="number"
                                        id="sd-north-hcp-min"
                                        placeholder="Min"
                                        class="w-full p-2 border rounded text-sm"
                                        value="15" />
                                    <span class="text-slate-400">-</span>
                                    <input
                                        type="number"
                                        id="sd-north-hcp-max"
                                        placeholder="Max"
                                        class="w-full p-2 border rounded text-sm"
                                        value="17" />
                                </div>
                            </div>
                            <div class="mb-4">
                                <label
                                    class="text-xs font-semibold text-slate-500 uppercase mb-1 block"
                                    >Shape Range</label
                                >
                                <div class="grid grid-cols-4 gap-2">
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-black">♠</span
                                        ><input
                                            type="text"
                                            id="sd-north-s"
                                            value="2-5"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-red-500">♥</span
                                        ><input
                                            type="text"
                                            id="sd-north-h"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-orange-500">♦</span
                                        ><input
                                            type="text"
                                            id="sd-north-d"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-green-600">♣</span
                                        ><input
                                            type="text"
                                            id="sd-north-c"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label
                                    class="text-xs font-semibold text-slate-500 uppercase mb-1 block"
                                    >Shape Type</label
                                >
                                <select
                                    id="sd-north-preset"
                                    class="w-full p-2 border rounded text-sm bg-white text-slate-700">
                                    <option value="any">指定なし</option>
                                    <option value="balanced">バランスハンド</option>
                                    <option value="semiBalanced">セミバランスハンド</option>
                                    <option value="unbalanced">アンバランスハンド</option>
                                    <option value="balanced-without-major">バランスハンド</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div
                        class="w-full md:col-start-1 md:row-start-2 bg-white p-5 rounded-lg border border-slate-200 shadow-sm">
                        <h4
                            class="font-bold text-slate-700 mb-4 flex items-center gap-2 border-b pb-2">
                            <i data-lucide="user" class="w-4 h-4"></i> West
                        </h4>
                        <div class="mb-4">
                            <label class="text-xs font-semibold text-slate-500 uppercase"
                                >HCP Range</label
                            >
                            <div class="flex items-center gap-2 mt-1">
                                <input
                                    type="number"
                                    id="sd-west-hcp-min"
                                    placeholder="Min"
                                    class="w-full p-2 border rounded text-sm"
                                    value="0" />
                                <span class="text-slate-400">-</span>
                                <input
                                    type="number"
                                    id="sd-west-hcp-max"
                                    placeholder="Max"
                                    class="w-full p-2 border rounded text-sm"
                                    value="37" />
                            </div>
                        </div>
                        <div class="mb-4">
                            <label
                                class="text-xs font-semibold text-slate-500 uppercase mb-1 block"
                                >Shape Range</label
                            >
                            <div class="grid grid-cols-4 gap-2">
                                <div class="text-center">
                                    <span class="text-xs font-bold text-black">♠</span
                                    ><input
                                        type="text"
                                        id="sd-west-s"
                                        class="w-full p-1 text-center border rounded text-xs mt-1"
                                        placeholder="0-13" />
                                </div>
                                <div class="text-center">
                                    <span class="text-xs font-bold text-red-500">♥</span
                                    ><input
                                        type="text"
                                        id="sd-west-h"
                                        class="w-full p-1 text-center border rounded text-xs mt-1"
                                        placeholder="0-13" />
                                </div>
                                <div class="text-center">
                                    <span class="text-xs font-bold text-orange-500">♦</span
                                    ><input
                                        type="text"
                                        id="sd-west-d"
                                        class="w-full p-1 text-center border rounded text-xs mt-1"
                                        placeholder="0-13" />
                                </div>
                                <div class="text-center">
                                    <span class="text-xs font-bold text-green-600">♣</span
                                    ><input
                                        type="text"
                                        id="sd-west-c"
                                        class="w-full p-1 text-center border rounded text-xs mt-1"
                                        placeholder="0-13" />
                                </div>
                            </div>
                        </div>
                        <div>
                            <label
                                class="text-xs font-semibold text-slate-500 uppercase mb-1 block"
                                >Shape Type</label
                            >
                            <select
                                id="sd-west-preset"
                                class="w-full p-2 border rounded text-sm bg-white text-slate-700">
                                <option value="any">指定なし</option>
                                <option value="balanced">バランスハンド</option>
                                <option value="semiBalanced">セミバランスハンド</option>
                                <option value="unbalanced">アンバランスハンド</option>
                                <option value="balanced-without-major">バランスハンド</option>
                            </select>
                        </div>
                    </div>

                    <div
                        class="w-full md:col-start-3 md:row-start-2 bg-white p-5 rounded-lg border border-slate-200 shadow-sm">
                        <h4
                            class="font-bold text-slate-700 mb-4 flex items-center gap-2 border-b pb-2">
                            <i data-lucide="user" class="w-4 h-4"></i> East
                        </h4>
                        <div class="mb-4">
                            <label class="text-xs font-semibold text-slate-500 uppercase"
                                >HCP Range</label
                            >
                            <div class="flex items-center gap-2 mt-1">
                                <input
                                    type="number"
                                    id="sd-east-hcp-min"
                                    placeholder="Min"
                                    class="w-full p-2 border rounded text-sm"
                                    value="0" />
                                <span class="text-slate-400">-</span>
                                <input
                                    type="number"
                                    id="sd-east-hcp-max"
                                    placeholder="Max"
                                    class="w-full p-2 border rounded text-sm"
                                    value="37" />
                            </div>
                        </div>
                        <div class="mb-4">
                            <label
                                class="text-xs font-semibold text-slate-500 uppercase mb-1 block"
                                >Shape Range</label
                            >
                            <div class="grid grid-cols-4 gap-2">
                                <div class="text-center">
                                    <span class="text-xs font-bold text-black">♠</span
                                    ><input
                                        type="text"
                                        id="sd-east-s"
                                        class="w-full p-1 text-center border rounded text-xs mt-1"
                                        placeholder="0-13" />
                                </div>
                                <div class="text-center">
                                    <span class="text-xs font-bold text-red-500">♥</span
                                    ><input
                                        type="text"
                                        id="sd-east-h"
                                        class="w-full p-1 text-center border rounded text-xs mt-1"
                                        placeholder="0-13" />
                                </div>
                                <div class="text-center">
                                    <span class="text-xs font-bold text-orange-500">♦</span
                                    ><input
                                        type="text"
                                        id="sd-east-d"
                                        class="w-full p-1 text-center border rounded text-xs mt-1"
                                        placeholder="0-13" />
                                </div>
                                <div class="text-center">
                                    <span class="text-xs font-bold text-green-600">♣</span
                                    ><input
                                        type="text"
                                        id="sd-east-c"
                                        class="w-full p-1 text-center border rounded text-xs mt-1"
                                        placeholder="0-13" />
                                </div>
                            </div>
                        </div>
                        <div>
                            <label
                                class="text-xs font-semibold text-slate-500 uppercase mb-1 block"
                                >Shape Type</label
                            >
                            <select
                                id="sd-east-preset"
                                class="w-full p-2 border rounded text-sm bg-white text-slate-700">
                                <option value="any">指定なし</option>
                                <option value="balanced">バランスハンド</option>
                                <option value="semiBalanced">セミバランスハンド</option>
                                <option value="unbalanced">アンバランスハンド</option>
                                <option value="balanced-without-major">バランスハンド</option>
                            </select>
                        </div>
                    </div>

                    <div
                        class="w-full md:col-start-2 md:row-start-3 bg-white p-5 rounded-lg border border-slate-200 shadow-sm relative z-10 md:-mt-6">
                        <div class="flex justify-between items-center mb-4 border-b pb-2">
                            <h4 class="font-bold text-slate-700 flex items-center gap-2">
                                <i data-lucide="user" class="w-4 h-4"></i> South
                            </h4>
                            <div class="flex bg-slate-100 rounded p-0.5">
                                <button
                                    class="sd-mode-switch px-2 py-0.5 text-[10px] font-bold rounded shadow-sm bg-white text-indigo-600"
                                    data-hand="south"
                                    data-mode="hand">
                                    Hand
                                </button>
                                <button
                                    class="sd-mode-switch px-2 py-0.5 text-[10px] font-bold rounded text-slate-500 hover:text-slate-700"
                                    data-hand="south"
                                    data-mode="feature">
                                    Feature
                                </button>
                            </div>
                        </div>

                        <div id="sd-mode-hand-south" class="sd-content-hand">
                            <div
                                class="text-[10px] text-white bg-slate-400 px-2 py-0.5 rounded-full inline-block mb-2 sd-count-badge">
                                0 / 13
                            </div>
                            <div id="sd-container-south" class="space-y-1"></div>
                        </div>

                        <div id="sd-mode-feature-south" class="sd-content-feature hidden">
                            <div class="mb-4">
                                <label class="text-xs font-semibold text-slate-500 uppercase"
                                    >HCP Range</label
                                >
                                <div class="flex items-center gap-2 mt-1">
                                    <input
                                        type="number"
                                        id="sd-south-hcp-min"
                                        placeholder="Min"
                                        class="w-full p-2 border rounded text-sm"
                                        value="0" />
                                    <span class="text-slate-400">-</span>
                                    <input
                                        type="number"
                                        id="sd-south-hcp-max"
                                        placeholder="Max"
                                        class="w-full p-2 border rounded text-sm"
                                        value="10" />
                                </div>
                            </div>
                            <div class="mb-4">
                                <label
                                    class="text-xs font-semibold text-slate-500 uppercase mb-1 block"
                                    >Shape Range</label
                                >
                                <div class="grid grid-cols-4 gap-2">
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-black">♠</span
                                        ><input
                                            type="text"
                                            id="sd-south-s"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-red-500">♥</span
                                        ><input
                                            type="text"
                                            id="sd-south-h"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-orange-500">♦</span
                                        ><input
                                            type="text"
                                            id="sd-south-d"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-green-600">♣</span
                                        ><input
                                            type="text"
                                            id="sd-south-c"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label
                                    class="text-xs font-semibold text-slate-500 uppercase mb-1 block"
                                    >Shape Type</label
                                >
                                <select
                                    id="sd-south-preset"
                                    class="w-full p-2 border rounded text-sm bg-white text-slate-700">
                                    <option value="any">指定なし</option>
                                    <option value="balanced">バランスハンド</option>
                                    <option value="semiBalanced">セミバランスハンド</option>
                                    <option value="unbalanced">アンバランスハンド</option>
                                    <option value="balanced-without-major">バランスハンド</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div
                    class="max-w-2xl mx-auto mt-6 mb-4 bg-white p-4 rounded-lg border border-slate-200 shadow-sm">
                    <h4 class="font-bold text-slate-700 mb-3 text-sm flex items-center gap-2">
                        <i data-lucide="sliders" class="w-4 h-4"></i> 詳細設定
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-semibold text-slate-500 mb-1"
                                >シミュレーション回数</label
                            >
                            <input
                                type="number"
                                id="sd-simulations"
                                class="w-full p-2 border rounded text-sm focus:outline-none focus:border-emerald-500"
                                value="1000" />
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-slate-500 mb-1"
                                >Advanced TCL (Optional)</label
                            >
                            <textarea
                                id="sd-advanced-tcl"
                                class="w-full p-2 border rounded text-sm h-[38px] focus:outline-none focus:border-emerald-500"
                                placeholder="e.g. reject if {...}"></textarea>
                        </div>
                    </div>
                </div>

                <div class="text-center mt-6 mb-10 md:mb-0">
                    <button
                        id="btn-run-single"
                        class="bg-emerald-600 hover:bg-emerald-700 text-white px-8 py-3 rounded-full font-bold shadow-lg shadow-emerald-200 transition-all active:scale-95 inline-flex items-center gap-2">
                        <i data-lucide="search" class="w-5 h-5"></i> 分析実行
                    </button>
                </div>

                <div
                    id="result-single"
                    class="hidden mt-8 max-w-4xl mx-auto w-full bg-white rounded-xl shadow-md overflow-hidden border border-slate-200">
                    <div
                        class="bg-emerald-50 px-4 py-3 border-b border-emerald-100 flex justify-between items-center">
                        <h3 class="font-bold text-emerald-900 flex items-center gap-2">
                            <i data-lucide="bar-chart-2" class="w-4 h-4"></i> 期待トリック数 (N/S)
                        </h3>
                        <span
                            id="sd-sim-count"
                            class="text-xs text-emerald-600 bg-white px-2 py-0.5 rounded border border-emerald-200"
                            >Samples: -</span
                        >
                    </div>
                    <div id="result-single-content" class="p-4 space-y-4"></div>
                </div>
            </div>

            <div id="view-lead" class="hidden fade-in">
                <h2 class="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                    <i data-lucide="search" class="text-orange-500"></i> Opening Lead Analyzer
                </h2>

                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 mb-8">
                    <h3 class="font-bold text-lg mb-4 text-slate-700 border-b pb-2">基本設定</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1"
                                >オープニングリーダー</label
                            >
                            <select id="lead-leader" class="w-full p-2 border rounded bg-slate-50">
                                <option value="West">West</option>
                                <option value="East">East</option>
                                <option value="North">North</option>
                                <option value="South">South</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1"
                                >コントラクト</label
                            >
                            <input
                                type="text"
                                id="lead-contract"
                                class="w-full p-2 border rounded bg-slate-50 focus:outline-none focus:border-orange-500"
                                placeholder="e.g. 3NT, 4S" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1"
                                >宣言側 (Declarer)</label
                            >
                            <div
                                id="lead-declarer-display"
                                class="p-2 text-slate-500 text-sm bg-slate-50 rounded border border-slate-200">
                                South (自動設定)
                            </div>
                        </div>
                        <div
                            class="md:col-span-3 grid grid-cols-1 md:grid-cols-2 gap-6 mt-2 pt-4 border-t border-slate-100">
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1"
                                    >シミュレーション回数</label
                                >
                                <input
                                    type="number"
                                    id="lead-simulations"
                                    class="w-full p-2 border rounded bg-slate-50 focus:outline-none focus:border-orange-500"
                                    value="1000" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1"
                                    >Advanced TCL (Optional)</label
                                >
                                <textarea
                                    id="lead-advanced-tcl"
                                    class="w-full p-2 border rounded bg-slate-50 h-10 focus:outline-none focus:border-orange-500"
                                    placeholder="e.g. reject if {...}"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div
                    class="max-w-7xl mx-auto w-full grid grid-cols-1 md:grid-cols-3 gap-y-2 md:gap-y-0 md:gap-x-4 place-items-stretch items-center mb-4">
                    <div
                        id="lead-panel-north"
                        class="w-full md:col-start-2 md:row-start-1 bg-white p-5 rounded-lg border border-slate-200 shadow-sm relative z-10 md:-mb-6">
                        <h4
                            class="font-bold text-slate-700 mb-4 flex items-center gap-2 border-b pb-2">
                            <i data-lucide="user" class="w-4 h-4"></i> North
                        </h4>
                        <div class="lead-card-selector hidden">
                            <p class="text-xs text-slate-500 mb-2">
                                正確なハンドを選択してください (13枚)
                            </p>
                            <div
                                class="text-[10px] text-white bg-slate-400 px-2 py-0.5 rounded-full inline-block mb-2 lead-count-badge">
                                0 / 13
                            </div>
                            <div id="lead-container-north" class="space-y-1"></div>
                        </div>
                        <div class="lead-feature-input">
                            <div class="mb-4">
                                <label class="text-xs font-semibold text-slate-500 uppercase"
                                    >HCP Range</label
                                >
                                <div class="flex items-center gap-2 mt-1">
                                    <input
                                        type="number"
                                        id="lead-north-hcp-min"
                                        placeholder="Min"
                                        class="w-full p-2 border rounded text-sm"
                                        value="0" />
                                    <span class="text-slate-400">-</span>
                                    <input
                                        type="number"
                                        id="lead-north-hcp-max"
                                        placeholder="Max"
                                        class="w-full p-2 border rounded text-sm"
                                        value="37" />
                                </div>
                            </div>
                            <div class="mb-4">
                                <label
                                    class="text-xs font-semibold text-slate-500 uppercase mb-1 block"
                                    >Shape Range</label
                                >
                                <div class="grid grid-cols-4 gap-2">
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-black">♠</span
                                        ><input
                                            type="text"
                                            id="lead-north-s"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-red-500">♥</span
                                        ><input
                                            type="text"
                                            id="lead-north-h"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-orange-500">♦</span
                                        ><input
                                            type="text"
                                            id="lead-north-d"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-green-600">♣</span
                                        ><input
                                            type="text"
                                            id="lead-north-c"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label
                                    class="text-xs font-semibold text-slate-500 uppercase mb-1 block"
                                    >Shape Type</label
                                >
                                <select
                                    id="lead-north-preset"
                                    class="w-full p-2 border rounded text-sm bg-white text-slate-700">
                                    <option value="any">指定なし</option>
                                    <option value="balanced">バランスハンド</option>
                                    <option value="semiBalanced">セミバランスハンド</option>
                                    <option value="unbalanced">アンバランスハンド</option>
                                    <option value="balanced-without-major">バランスハンド</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div
                        id="lead-panel-west"
                        class="w-full md:col-start-1 md:row-start-2 bg-white p-5 rounded-lg border border-slate-200 shadow-sm relative">
                        <h4
                            class="font-bold text-slate-700 mb-4 flex items-center gap-2 border-b pb-2">
                            <i data-lucide="user" class="w-4 h-4"></i> West
                        </h4>
                        <div class="lead-card-selector hidden">
                            <p class="text-xs text-slate-500 mb-2">
                                正確なハンドを選択してください (13枚)
                            </p>
                            <div
                                class="text-[10px] text-white bg-slate-400 px-2 py-0.5 rounded-full inline-block mb-2 lead-count-badge">
                                0 / 13
                            </div>
                            <div id="lead-container-west" class="space-y-1"></div>
                        </div>
                        <div class="lead-feature-input">
                            <div class="mb-4">
                                <label class="text-xs font-semibold text-slate-500 uppercase"
                                    >HCP Range</label
                                >
                                <div class="flex items-center gap-2 mt-1">
                                    <input
                                        type="number"
                                        id="lead-west-hcp-min"
                                        placeholder="Min"
                                        class="w-full p-2 border rounded text-sm"
                                        value="0" />
                                    <span class="text-slate-400">-</span>
                                    <input
                                        type="number"
                                        id="lead-west-hcp-max"
                                        placeholder="Max"
                                        class="w-full p-2 border rounded text-sm"
                                        value="37" />
                                </div>
                            </div>
                            <div class="mb-4">
                                <label
                                    class="text-xs font-semibold text-slate-500 uppercase mb-1 block"
                                    >Shape Range</label
                                >
                                <div class="grid grid-cols-4 gap-2">
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-black">♠</span
                                        ><input
                                            type="text"
                                            id="lead-west-s"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-red-500">♥</span
                                        ><input
                                            type="text"
                                            id="lead-west-h"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-orange-500">♦</span
                                        ><input
                                            type="text"
                                            id="lead-west-d"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-green-600">♣</span
                                        ><input
                                            type="text"
                                            id="lead-west-c"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label
                                    class="text-xs font-semibold text-slate-500 uppercase mb-1 block"
                                    >Shape Type</label
                                >
                                <select
                                    id="lead-west-preset"
                                    class="w-full p-2 border rounded text-sm bg-white text-slate-700">
                                    <option value="any">指定なし</option>
                                    <option value="balanced">バランスハンド</option>
                                    <option value="semiBalanced">セミバランスハンド</option>
                                    <option value="unbalanced">アンバランスハンド</option>
                                    <option value="balanced-without-major">バランスハンド</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div
                        id="lead-panel-east"
                        class="w-full md:col-start-3 md:row-start-2 bg-white p-5 rounded-lg border border-slate-200 shadow-sm relative">
                        <h4
                            class="font-bold text-slate-700 mb-4 flex items-center gap-2 border-b pb-2">
                            <i data-lucide="user" class="w-4 h-4"></i> East
                        </h4>
                        <div class="lead-card-selector hidden">
                            <p class="text-xs text-slate-500 mb-2">
                                正確なハンドを選択してください (13枚)
                            </p>
                            <div
                                class="text-[10px] text-white bg-slate-400 px-2 py-0.5 rounded-full inline-block mb-2 lead-count-badge">
                                0 / 13
                            </div>
                            <div id="lead-container-east" class="space-y-1"></div>
                        </div>
                        <div class="lead-feature-input">
                            <div class="mb-4">
                                <label class="text-xs font-semibold text-slate-500 uppercase"
                                    >HCP Range</label
                                >
                                <div class="flex items-center gap-2 mt-1">
                                    <input
                                        type="number"
                                        id="lead-east-hcp-min"
                                        placeholder="Min"
                                        class="w-full p-2 border rounded text-sm"
                                        value="0" />
                                    <span class="text-slate-400">-</span>
                                    <input
                                        type="number"
                                        id="lead-east-hcp-max"
                                        placeholder="Max"
                                        class="w-full p-2 border rounded text-sm"
                                        value="37" />
                                </div>
                            </div>
                            <div class="mb-4">
                                <label
                                    class="text-xs font-semibold text-slate-500 uppercase mb-1 block"
                                    >Shape Range</label
                                >
                                <div class="grid grid-cols-4 gap-2">
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-black">♠</span
                                        ><input
                                            type="text"
                                            id="lead-east-s"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-red-500">♥</span
                                        ><input
                                            type="text"
                                            id="lead-east-h"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-orange-500">♦</span
                                        ><input
                                            type="text"
                                            id="lead-east-d"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-green-600">♣</span
                                        ><input
                                            type="text"
                                            id="lead-east-c"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label
                                    class="text-xs font-semibold text-slate-500 uppercase mb-1 block"
                                    >Shape Type</label
                                >
                                <select
                                    id="lead-east-preset"
                                    class="w-full p-2 border rounded text-sm bg-white text-slate-700">
                                    <option value="any">指定なし</option>
                                    <option value="balanced">バランスハンド</option>
                                    <option value="semiBalanced">セミバランスハンド</option>
                                    <option value="unbalanced">アンバランスハンド</option>
                                    <option value="balanced-without-major">バランスハンド</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div
                        id="lead-panel-south"
                        class="w-full md:col-start-2 md:row-start-3 bg-white p-5 rounded-lg border border-slate-200 shadow-sm relative z-10 md:-mt-6">
                        <h4
                            class="font-bold text-slate-700 mb-4 flex items-center gap-2 border-b pb-2">
                            <i data-lucide="user" class="w-4 h-4"></i> South
                        </h4>
                        <div class="lead-card-selector hidden">
                            <p class="text-xs text-slate-500 mb-2">
                                正確なハンドを選択してください (13枚)
                            </p>
                            <div
                                class="text-[10px] text-white bg-slate-400 px-2 py-0.5 rounded-full inline-block mb-2 lead-count-badge">
                                0 / 13
                            </div>
                            <div id="lead-container-south" class="space-y-1"></div>
                        </div>
                        <div class="lead-feature-input">
                            <div class="mb-4">
                                <label class="text-xs font-semibold text-slate-500 uppercase"
                                    >HCP Range</label
                                >
                                <div class="flex items-center gap-2 mt-1">
                                    <input
                                        type="number"
                                        id="lead-south-hcp-min"
                                        placeholder="Min"
                                        class="w-full p-2 border rounded text-sm"
                                        value="0" />
                                    <span class="text-slate-400">-</span>
                                    <input
                                        type="number"
                                        id="lead-south-hcp-max"
                                        placeholder="Max"
                                        class="w-full p-2 border rounded text-sm"
                                        value="37" />
                                </div>
                            </div>
                            <div class="mb-4">
                                <label
                                    class="text-xs font-semibold text-slate-500 uppercase mb-1 block"
                                    >Shape Range</label
                                >
                                <div class="grid grid-cols-4 gap-2">
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-black">♠</span
                                        ><input
                                            type="text"
                                            id="lead-south-s"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-red-500">♥</span
                                        ><input
                                            type="text"
                                            id="lead-south-h"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-orange-500">♦</span
                                        ><input
                                            type="text"
                                            id="lead-south-d"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                    <div class="text-center">
                                        <span class="text-xs font-bold text-green-600">♣</span
                                        ><input
                                            type="text"
                                            id="lead-south-c"
                                            class="w-full p-1 text-center border rounded text-xs mt-1"
                                            placeholder="0-13" />
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label
                                    class="text-xs font-semibold text-slate-500 uppercase mb-1 block"
                                    >Shape Type</label
                                >
                                <select
                                    id="lead-south-preset"
                                    class="w-full p-2 border rounded text-sm bg-white text-slate-700">
                                    <option value="any">指定なし</option>
                                    <option value="balanced">バランスハンド</option>
                                    <option value="semiBalanced">セミバランスハンド</option>
                                    <option value="unbalanced">アンバランスハンド</option>
                                    <option value="balanced-without-major">バランスハンド</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-center mt-6 mb-10 md:mb-0">
                    <button
                        id="btn-run-lead"
                        class="bg-orange-600 hover:bg-orange-700 text-white px-10 py-3 rounded-full font-bold shadow-lg shadow-orange-200 transition-all active:scale-95 inline-flex items-center gap-2">
                        <i data-lucide="zap" class="w-5 h-5"></i> 分析実行
                    </button>
                </div>

                <div
                    id="result-lead"
                    class="hidden mt-8 w-full bg-white rounded-xl shadow-md border border-slate-200 overflow-hidden">
                    <div
                        class="bg-orange-50 px-4 py-3 border-b border-orange-100 flex justify-between items-center">
                        <h3 class="font-bold text-orange-900 flex items-center gap-2">
                            <i data-lucide="bar-chart" class="w-4 h-4"></i> 獲得トリック確率分布
                        </h3>
                        <div class="flex gap-2 text-[10px] md:text-xs">
                            <span class="text-orange-600 font-bold"
                                >Simulations: <span id="lead-sim-count">-</span></span
                            >
                        </div>
                    </div>
                    <div id="result-lead-content" class="p-4 space-y-6"></div>
                </div>
            </div>
        </main>

        <footer class="bg-slate-900 text-slate-300 py-12 mt-auto">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                    <div>
                        <h3 class="text-white text-lg font-bold mb-4">Bridge Solver</h3>
                        <p class="text-sm leading-relaxed mb-4">
                            モダンなブラウザで動作するコントラクトブリッジ分析プラットフォーム。
                        </p>
                    </div>
                    <div>
                        <h4 class="text-white font-bold mb-4">Tools</h4>
                        <ul class="space-y-2 text-sm">
                            <li>Double Dummy Solver</li>
                            <li>Single Dummy Solver</li>
                            <li>Opening Lead Analyzer</li>
                        </ul>
                    </div>
                </div>
                <div
                    class="mt-12 pt-8 border-t border-slate-800 text-center text-xs text-slate-500">
                    &copy; 2024 Bridge Solver
                </div>
            </div>
        </footer>

        <div
            id="toast"
            class="fixed bottom-20 right-4 md:bottom-8 md:right-8 z-50 transition-all duration-300 translate-x-full opacity-0">
            <div
                class="bg-slate-800 text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-3">
                <i data-lucide="info" class="w-5 h-5 text-indigo-400"></i>
                <span id="toast-msg">Notification</span>
            </div>
        </div>

        <div
            id="loading-overlay"
            class="hidden fixed inset-0 bg-slate-900/50 z-[100] flex items-center justify-center backdrop-blur-sm">
            <div class="bg-white p-6 rounded-xl shadow-2xl flex flex-col items-center">
                <div
                    class="w-10 h-10 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mb-3"></div>
                <span class="font-bold text-slate-700">Analyzing...</span>
            </div>
        </div>

        <div
            id="mobile-keyboard"
            class="md:hidden bg-white border-t border-slate-200 shadow-[0_-4px_10px_rgba(0,0,0,0.1)] fixed bottom-0 left-0 right-0 z-40 pb-6 pt-2 transition-transform duration-300 translate-y-full">
            <div class="px-2">
                <div class="flex justify-between items-center mb-2 px-2">
                    <span
                        class="text-xs font-bold text-indigo-600 uppercase tracking-wider"
                        id="mobile-active-label"
                        >Editing: North</span
                    >
                    <div class="flex gap-2">
                        <button
                            onclick="document.getElementById('btn-run-double').click()"
                            class="text-xs bg-indigo-600 text-white px-3 py-1 rounded shadow">
                            Analyze
                        </button>
                    </div>
                </div>
                <div class="space-y-1 select-none">
                    <div
                        id="mobile-keys-s"
                        class="flex gap-1 overflow-x-auto pb-1 no-scrollbar"></div>
                    <div
                        id="mobile-keys-h"
                        class="flex gap-1 overflow-x-auto pb-1 no-scrollbar"></div>
                    <div
                        id="mobile-keys-d"
                        class="flex gap-1 overflow-x-auto pb-1 no-scrollbar"></div>
                    <div
                        id="mobile-keys-c"
                        class="flex gap-1 overflow-x-auto pb-1 no-scrollbar"></div>
                </div>
            </div>
        </div>

        <script src="script.js"></script>
    </body>
</html>
